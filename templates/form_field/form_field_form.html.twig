{% extends '@OHMediaBackend/form.html.twig' %}

{% set form_field_fqns = 'OHMedia\\FormBundle\\Entity\\FormField' %}

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const typeChoice = "{{ constant(form_field_fqns ~ '::TYPE_CHOICE') }}";
  const typeEmail = "{{ constant(form_field_fqns ~ '::TYPE_EMAIL') }}";
  const typePhone = "{{ constant(form_field_fqns ~ '::TYPE_PHONE') }}";

  const type = document.getElementById('{{ form.type.vars.id }}');

  const form = type.form;

  const help = document.getElementById('{{ form.help.vars.id }}');

  const choices = document.getElementById('{{ form.choices.vars.id }}');

  const multiple = form.elements['{{ form.multiple.vars.full_name }}'];

  const copy = form.elements['{{ form.copy.vars.full_name }}'];

  const reply = form.elements['{{ form.reply.vars.full_name }}'];

  function onTypeChange() {
    const isTypeChoice = typeChoice === type.value;
    const isTypeEmail = typeEmail === type.value;
    const isTypePhone = typePhone === type.value;

    help.parentNode.style.display = isTypePhone ? 'none' : '';

    choices.parentNode.style.display = isTypeChoice ? '' : 'none';
    choices.required = isTypeChoice;

    toggleRadioNodeList(multiple, isTypeChoice);

    toggleRadioNodeList(copy, isTypeEmail);
    toggleRadioNodeList(reply, isTypeEmail);
  }

  function toggleRadioNodeList(radioNodeList, show) {
    const container = radioNodeList[0].parentNode.parentNode;

    container.parentNode.style.display = show ? '' : 'none';
    radioNodeList.forEach((radio) => {
      radio.required = show;
    });
  }

  type.addEventListener('change', onTypeChange);

  onTypeChange();
});
</script>
{% endblock %}
